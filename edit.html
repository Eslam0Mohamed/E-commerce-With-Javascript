<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Product</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header>
        <div class="logo">
            Shop Now
        </div>
        <ul>
            <li><a href="index.html">Products</a></li>
            <li><a href="admin.html">Admin</a></li>
            <li><a href="create.html">Create</a></li>
        </ul>
    </header>
    <div class="form">
        <form action="">
            <div class="edit-form">
                <label for="" class="edit-form-label">Enter Product Name</label>
                <input type="text" class="edit-form-input" id="name">
            </div>
            <div class="edit-form">
                <label for="" class="edit-form-label">Enter Product Price</label>
                <input type="number" class="edit-form-input" id="price">
                <button class="update">Update Product</button>
            </div>
        </form>
    </div>
    <div id="modal" class="modal">
  <div class="modal-content">
    <p id="modal-message">Your message goes here</p>
    <button id="close-modal">Close</button>
  </div>
</div>
<div class="loader-container">
    <span class="loader"></span>
</div>
    <script>
        const id = new URLSearchParams(window.location.search).get("id")
        const loader = document.querySelector(".loader-container")
        let name = document.getElementById("name")
        let price = document.getElementById("price")
        let updateBtn = document.querySelector(".update")
        const modal = document.getElementById("modal");
const modalMsg = document.getElementById("modal-message");
const closeModal = document.getElementById("close-modal");

function showLoader(){
loader.style.display = "flex"
}
function removeLoader(){
loader.style.display = "none"
}

function showModal(message) {
  modalMsg.textContent = message;
  modal.style.display = "flex";
}

closeModal.addEventListener("click", () => {
  modal.style.display = "none";
});
        async function getProduct() {
            showLoader()
            try {
           const response = await fetch(`https://api.escuelajs.co/api/v1/products/${id}`)
            console.log(response);
            
            const product = await response.json()
            console.log(product);
            name.value = product.title
            price.value = product.price
            } catch (error) {
                console.log(error);   
            }

            removeLoader()

        }

        getProduct()

        updateBtn.addEventListener("click", async function(e) {
            showLoader()
            e.preventDefault()
            console.log(id);
            console.log("Clicked");
            try {
                const response = await fetch(`https://api.escuelajs.co/api/v1/products/${id}`, {
                    method: "PUT",
                    headers:{ "Content-Type": "application/json"},
                    body: JSON.stringify({title: name.value,price: +price.value}),
                })
                console.log(response);
                
                console.log(await response.json());
                
                if (response.ok) {
                    // alert("the details have been changed")
                    showModal("the details have been changed")
                }
                else {
                   
                    showModal("there is an error")
                }

            } catch (error) {
console.log("There is an Error ," + error);

            }
            removeLoader()
        })

    </script>
</body>

</html>